

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extractors &mdash; Graylog 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Graylog 1.0 documentation" href="../index.html"/>
        <link rel="prev" title="Streams" href="streams.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Graylog</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="streams.html">Streams</a><ul>
<li class="toctree-l2"><a class="reference internal" href="streams.html#what-are-streams">What are streams?</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#alerts">Alerts</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#outputs">Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#use-cases">Use cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#how-are-streams-processed-internally">How are streams processed internally?</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#stream-processing-runtime-limits">Stream Processing Runtime Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#programmatic-access-via-the-rest-api">Programmatic access via the REST API</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html#faqs">FAQs</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Extractors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-problem-to-solve">The problem to solve</a></li>
<li class="toctree-l2"><a class="reference internal" href="#graylog-extractors-explained">Graylog extractors explained</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-extractor-directory">The extractor directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-regular-expressions-to-extract-data">Using regular expressions to extract data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#normalization">Normalization</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Graylog</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Extractors</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/pages/extractors.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="extractors">
<h1>Extractors<a class="headerlink" href="#extractors" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-problem-to-solve">
<h2>The problem to solve<a class="headerlink" href="#the-problem-to-solve" title="Permalink to this headline">¶</a></h2>
<p>Syslog (<a class="reference external" href="http://tools.ietf.org/html/rfc3146">RFC3146</a>, <a class="reference external" href="http://tools.ietf.org/html/rfc5424">RFC5424</a>) is the de facto
standard logging protocol since the 80s and was originally developed as part of the sendmail project. It comes with some
annoying shortcomings that we tried to improve in <a class="reference external" href="http://www.graylog.org/gelf">GELF</a> for application logging.</p>
<p>Because syslog has a clear specification in its RFCs it should be possible to parse it relatively easy. Unfortunately
there are a lot of devices (especially routers and firewalls) out there that send logs looking like syslog but actually
breaking several rules stated in the RFCs. We tried to write a parser that reads all of them as good as possible and
failed. Such a loosely defined text message usually breaks the compatibility in the first date field already. Some
devices leave out hostnames completely, some use localized timezone names (MESZ instead of CEST) and some just omit the
current year.</p>
<p>Then there are devices out there that at least do not claim to send syslog when they don&#8217;t but have another completely
separate log format that needs to be parsed specifically.</p>
<p>We decided not to write custom message inputs and parsers for all those thousands of devices, formats, firmwares and
configuration parameters out there but came up with the concept of <em>Extractors</em> in the <em>v0.20.0</em> series of Graylog.</p>
</div>
<div class="section" id="graylog-extractors-explained">
<h2>Graylog extractors explained<a class="headerlink" href="#graylog-extractors-explained" title="Permalink to this headline">¶</a></h2>
<p>The extractors allow you to instruct <code class="docutils literal"><span class="pre">graylog-server</span></code> nodes about how to extract data from any text in the received
message (no matter from which format or if an already extracted field) to message fields. You may already know why
structuring data into fields is important if you are using Graylog: There are a lot of analysis possibilities with
full text searches but the real power of log analytics unveils when you can run queries like
<code class="docutils literal"><span class="pre">http_response_code:&gt;=500</span> <span class="pre">AND</span> <span class="pre">user_id:9001</span></code> to get all HTTP 500s that were triggered by a specific user.</p>
<p>Wouldn&#8217;t it be nice to be able to search for all blocked packages of a given source IP or to get a quickterms analysis
of recently failed SSH login usernames? Hard to do when all you have is just a single long text message.</p>
<p>Creating extractors is possible via either Graylog REST API calls or directly from the web interface using a wizard. Select
a message input and hit <em>Manage extractors</em> in the actions menu. The wizard allows you to load a message to try your extractor
configuration against. You can extract data using for example regular expressions, grok patterns, substrings or even
by splitting the message into tokens by separator characters. The wizard looks like this and should be pretty intuitive:</p>
<img alt="../_images/extractors_1.png" src="../_images/extractors_1.png" />
<p>You can also choose to apply so called <em>converters</em> on the extracted value to for example convert a string consisting
of numbers to an integer/double (important for range searches later), anonymize IP addresses, lowercase/uppercase a
string, build a hash value or much more.</p>
</div>
<div class="section" id="the-extractor-directory">
<h2>The extractor directory<a class="headerlink" href="#the-extractor-directory" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.graylog2.org/supported-sources">data source library</a> contains a lot of extractors that you can easily
import into your Graylog setup.</p>
<p>Just copy the JSON extractor export into the import dialog of an input of the fitting type (Every extractor set entry in
the directory tells you what type of input to spawn. For example syslog, GELF or plaintext.) and you are good to go.
The next message coming in should already include the extracted fields with possibly converted values.</p>
<p>A message sent by Heroku and received by Graylog with the imported <em>Heroku</em> extractor set on a plaintext TCP input
looks like this: (look at the extracted fields in the message detail view)</p>
<img alt="../_images/extractors_2.png" src="../_images/extractors_2.png" />
</div>
<div class="section" id="using-regular-expressions-to-extract-data">
<h2>Using regular expressions to extract data<a class="headerlink" href="#using-regular-expressions-to-extract-data" title="Permalink to this headline">¶</a></h2>
<p>Extractors support matching field values using regular expressions.
Graylog uses the <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">Java Pattern class</a> to
evaluate regular expressions.</p>
<p>For the individual elements of regular expression syntax, please refer to Oracle&#8217;s documentation, however the syntax
largely follows the familiar regular expression languages in widespread use today and will be familiar to most.</p>
<p>However, one key question that is often raised is matching a string in case insensitive manner. Java regular expressions
are case sensitive by default. Certain flags, such as the one to ignore case sensitivity can either be set in the code,
or as an inline flag in the regular expression.</p>
<p>To for example create an extractor that matches the browser name in the following user agent string:</p>
<div class="highlight-python"><div class="highlight"><pre>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.107 Safari/537.36
</pre></div>
</div>
<p>the regular expression <code class="docutils literal"><span class="pre">(applewebkit)</span></code> will not match because it is case sensitive.
In order to match the expression using any combination of upper- and lowercase characters use the <code class="docutils literal"><span class="pre">(?i)</span></code> flag as such:</p>
<div class="highlight-python"><div class="highlight"><pre>(?i)(applewebkit)
</pre></div>
</div>
<p>Most of the other flags supported by Java are rarely used in the context of matching stream rules or extractors, but if
you need them their use is documented on the same Javadoc page by Oracle. One common reason to use regular expression flags
in your regular expression is to make use of what is called non-capturing groups. Those are parentheses which only group
alternatives, but do not make Graylog extract the data they match and are indicated by <code class="docutils literal"><span class="pre">(?:)</span></code>.</p>
</div>
<div class="section" id="normalization">
<h2>Normalization<a class="headerlink" href="#normalization" title="Permalink to this headline">¶</a></h2>
<p>Many log formats are similar to each other, but not quite the same. In particular they often only differ in the names attached
to pieces of information.</p>
<p>For example, consider different hardware firewall vendors, whose models log the destination IP in different fields of the message,
some use <code class="docutils literal"><span class="pre">dstip</span></code>, some <code class="docutils literal"><span class="pre">dst</span></code> and yet others use <code class="docutils literal"><span class="pre">destination-address</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>2004-10-13 10:37:17 PDT Packet Length=50824, Source address=172.17.22.108, Source port=829, Destination address=192.168.70.66, Destination port=513
2004-10-13 10:37:17 PDT len=50824 src=172.17.22.108 sport=829 dst=192.168.70.66 dport=513
2004-10-13 10:37:17 PDT length=&quot;50824&quot; srcip=&quot;172.17.22.108&quot; srcport=&quot;829&quot; dstip=&quot;192.168.70.66&quot; dstport=&quot;513&quot;
</pre></div>
</div>
<p>You can use one or more non-capturing groups to specify the alternatives of the field names, but still be able to extract the a
parentheses group in the regular expression. Remember that Graylog will extract data from the first matched group of the regular
expression. An example of a regular expression matching the destination IP field of all those log messages from above is:</p>
<div class="highlight-python"><div class="highlight"><pre>(?:dst|dstip|[dD]estination\saddress)=&quot;?(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})&quot;?
</pre></div>
</div>
<p>This will only extract the IP address without caring about which of the three naming schemes was used in the original log message.
This way you don&#8217;t have to set up three different extractors.</p>
<div class="section" id="the-standard-date-converter">
<h3>The standard date converter<a class="headerlink" href="#the-standard-date-converter" title="Permalink to this headline">¶</a></h3>
<p>Date parser converters for extractors allow you to convert extracted data into timestamps - Usually used to set the timestamp of
a message based on some date it contains. Let&#8217;s assume we have this message from a network device:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;131&gt;: foo-bar-dc3-org-de01: Mar 12 00:45:38: %LINK-3-UPDOWN: Interface GigabitEthernet0/31, changed state to down
</pre></div>
</div>
<p>Extracting most of the data is not a problem and can be done easily. Using the date in the message (<cite>Mar 12 00:45:38</cite>) as Graylog
message timestamp however needs to be done with a date parser converter.</p>
<p>Use a standard extractor rule to select the timestamp and apply the <em>Date</em> converter with a format string:</p>
<div class="highlight-python"><div class="highlight"><pre>MMM dd HH:mm:ss
</pre></div>
</div>
<p>(format string table at the end of this page)</p>
<img alt="../_images/dateparser_1.png" src="../_images/dateparser_1.png" />
<img alt="../_images/dateparser_2.png" src="../_images/dateparser_2.png" />
</div>
<div class="section" id="the-flexible-date-converter">
<h3>The flexible date converter<a class="headerlink" href="#the-flexible-date-converter" title="Permalink to this headline">¶</a></h3>
<p>Now imagine you had one of those devices that send messages that are not so easy to parse because they do not follow a strict
timestamp format. Some network devices for example like to send days of the month without adding a padding 0 for the first 9 days.
You&#8217;ll have dates like <code class="docutils literal"><span class="pre">Mar</span> <span class="pre">9</span></code> and <code class="docutils literal"><span class="pre">Mar</span> <span class="pre">10</span></code> and end up having problems defining a parser string for that. Or maybe you have
something else that is really exotic like just <em>last wednesday</em> as timestamp. The flexible date converter is accepting any
text data and tries to build a date from that as good as it can.</p>
<p>Examples:</p>
<ul class="simple">
<li><strong>Mar 12</strong>, converted at 12:27:00 local time in the year 2014: 2014-03-12T12:27:00.000</li>
<li><strong>2014-3-12 12:27</strong>: 2014-03-12T12:27:00.000</li>
<li><strong>Mar 12 2pm</strong>: 2014-03-12T14:00:00.000</li>
</ul>
<p>Note that the flexible date converter always uses the local timezone unless you have timezone information in the parsed text.</p>
<div class="section" id="standard-date-converter-format-string-table">
<h4>Standard date converter format string table<a class="headerlink" href="#standard-date-converter-format-string-table" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="35%" />
<col width="15%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Symbol</th>
<th class="head">Meaning</th>
<th class="head">Presentation</th>
<th class="head">Examples</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>G</td>
<td>era</td>
<td>text</td>
<td>AD</td>
</tr>
<tr class="row-odd"><td>C</td>
<td>century of era (&gt;=0)</td>
<td>number</td>
<td>20</td>
</tr>
<tr class="row-even"><td>Y</td>
<td>year of era (&gt;=0)</td>
<td>year</td>
<td>1996</td>
</tr>
<tr class="row-odd"><td>x</td>
<td>weekyear</td>
<td>year</td>
<td>1996</td>
</tr>
<tr class="row-even"><td>w</td>
<td>week of weekyear</td>
<td>number</td>
<td>27</td>
</tr>
<tr class="row-odd"><td>e</td>
<td>day of week</td>
<td>number</td>
<td>2</td>
</tr>
<tr class="row-even"><td>E</td>
<td>day of week</td>
<td>text</td>
<td>Tuesday; Tue</td>
</tr>
<tr class="row-odd"><td>y</td>
<td>year</td>
<td>year</td>
<td>1996</td>
</tr>
<tr class="row-even"><td>D</td>
<td>day of year</td>
<td>number</td>
<td>189</td>
</tr>
<tr class="row-odd"><td>M</td>
<td>month of year</td>
<td>month</td>
<td>July; Jul; 07</td>
</tr>
<tr class="row-even"><td>d</td>
<td>day of month</td>
<td>number</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>a</td>
<td>halfday of day</td>
<td>text</td>
<td>PM</td>
</tr>
<tr class="row-even"><td>K</td>
<td>hour of halfday (0~11)</td>
<td>number</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>h</td>
<td>clockhour of halfday (1~12)</td>
<td>number</td>
<td>12</td>
</tr>
<tr class="row-even"><td>H</td>
<td>hour of day (0~23)</td>
<td>number</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>k</td>
<td>clockhour of day (1~24)</td>
<td>number</td>
<td>24</td>
</tr>
<tr class="row-even"><td>m</td>
<td>minute of hour</td>
<td>number</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>s</td>
<td>second of minute</td>
<td>number</td>
<td>55</td>
</tr>
<tr class="row-even"><td>S</td>
<td>fraction of second</td>
<td>millis</td>
<td>978</td>
</tr>
<tr class="row-odd"><td>z</td>
<td>time zone</td>
<td>text</td>
<td>Pacific Standard Time; PST</td>
</tr>
<tr class="row-even"><td>Z</td>
<td>time zone offset/id</td>
<td>zone</td>
<td>-0800; -08:00; America/Los_Angeles</td>
</tr>
<tr class="row-odd"><td>&#8216;</td>
<td>escape for text</td>
<td>delimiter</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&#8216;&#8217;</td>
<td>single quote</td>
<td>literal</td>
<td>&#8216;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="streams.html" class="btn btn-neutral" title="Streams"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 Graylog, Inc.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>